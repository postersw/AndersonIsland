<!DOCTYPE html>
<!--
    Copyright (c) 2012-2014 Adobe Systems Incorporated. All rights reserved.

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
     KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.
-->
<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=medium-dpi" /> <!--device-dpi" />-->
<link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <title>Anderson Island Assistant</title>
    <style>
        button {
            font-size: 18px;
        }

        p {
            font-size: 14px;
        }
        li {border-style:solid;border-width:thin;border-color:gray;padding-top:6px;padding-bottom:6px;padding-left:6px}
    </style>


</head>
<body>
    <div class="app">
        <div data-role="content"></div>
        <h1 style="font-size:24px;margin-bottom:0px">Anderson Island Assistant <button onclick="LocalMenu();">&#8801</button></h1>
        <span id="topline" style="font-size:small;padding-top:-4px;margin-bottom:0px">Touch an entry for more information.</span>
        <!--<p>All sorts of usefull information in an up-to-date easy-to-use app.</p>-->
 <ul style="list-style-type:none;margin:0;padding:0">
        <li style="background-color:azure" onclick="window.open('localferryschedule.html');" >
            <span style="font-size:18px;color:darkblue;margin-left:0%">FERRY </span>
            <span id="ferrytimes" style="font-size:small;margin-top:4px;margin-bottom:4px">Next : </span>
            </li>
        <li style="background-color:azure" onclick="ShowFerryCams();" >
            <span style="font-size:18px;color:darkblue;margin-left:0%">FERRY WEBCAMS </span>
        </li>

          <li style="background-color:lightcyan"  onclick="ShowTides();"> 
            <span style="font-size:18px;color:darkblue;margin-left:0%">
            TIDES </span>
         <span id="tides" style="font-size:small;margin-top:2px;margin-bottom:4px">Next tides:</span>
         </li>

     <li style="background-color:honeydew"  onclick="ShowWeather();"> 
            <span style="font-size:18px;color:darkgreen;margin-left:0%">
            WEATHER </span>
         <span id="weather" style="font-size:small;margin-top:4px;margin-bottom:0px">Current weather:</span> 
         <p id="forecast" style="font-size:small;margin-top:4px;margin-bottom:0px">Forecast: </p>

         </li>


      <li style="background-color:honeydew"  onclick="ShowBurnBan();"> 
            <span style="font-size:18px;color:darkgreen;margin-left:0%">
            BURN BAN </span>
         <span id="burnban" style="font-size:small;margin-top:2px;margin-bottom:4px">Click for burn ban status.</span>
         </li>

        <li style="background-color:floralwhite;"  onclick="window.open('comingevents.html?events');">
        <span style="font-size:18px;color:darkmagenta;">
            EVENTS </span>
            <span id="nextevent" style="font-size:small;margin-top:4px;margin-bottom:4px">Next Event:</span>
        </li>
        <li style="background-color:floralwhite;"  onclick="window.open('comingevents.html?activities');">
        <span style="font-size:18px;color:darkmagenta;">
            ACTIVITY </span>
            <span id="nextactivity" style="font-size:small;margin-top:4px;margin-bottom:4px">Next Activity:</span>
        </li>

     <li style="background-color:lightyellow" onclick="window.open('openhours.html');">
            <span style="font-size:18px;color:darkorange;">OPEN HOURS</span>
             <span id="openhours" style="font-size:small;margin-top:4px;margin-bottom:4px">
            </span>
         </li>

         <li style="background-color:antiquewhite;" onclick="window.open('emergencycontacts.html')">  
            <span style="font-size:18px;color:darkred">
             EMERGENCY CONTACTS </span>
         </li>

        <li style="background-color:skyblue" onclick="ShowMap();"> 
        <span style="font-size:18px;color:darkblue;margin-left:0%">
            MAP </span>             
        </li>

          <li >
             <span style="font-size:18px;color:black">ISLAND INFORMATION </span><br />

            <button style="width:100%;padding:6px" onclick="window.open('http://www.aicab.org');">Citizens Advisory Board</button><br />
            <button style="width:100%;padding:6px" onclick="window.open('http://www.andersonislandcc.org');">Community Club</button><br />   
            <button style="width:100%;padding:6px" onclick="window.open('http://andersonislandhs.org');">Historical Society</button><br />                 
            <button style="width:100%;padding:6px" onclick="window.open('http://www.andersonislandsafety.org');">Island Patrol</button><br />
            <button style="width:100%;padding:6px" onclick="window.open('http://www.yellowbook.com/local-business-directory/?where=anderson+island%2C+wa');">Local Businesses</button><br />
            <button style="width:100%;padding:6px" onclick="window.open('http://andersonislandparks.org');">Parks</button><br />
            <button style="width:100%;padding:6px" onclick="window.open('http://rivieracommunityclub.com');">Riviera</button><br />
            <button style="width:100%;padding:6px" onclick="window.open('http://www.andersonislandgeneralstore.com');">Store</button><br />
            <button style="width:100%;padding:6px" onclick="window.open('http://www.tannerelectric.coop');">Tanner Electric</button><br />
                         


       </li>
          <li>
            <button style="width:100%" onclick="window.open('aboutus.html');">About Us</button><br />
 </li>
          </ul>

    <div id="deviceready" class="blink">
        <p class="event listening">Connecting to Device</p>
        <p class="event received">Device is Ready</p>
    </div>
</div>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript" src="js/AIA.js"></script>

    <script>
        // global date variables. note: scope is for one page only.
        //var d; // date object
        //var dayofweek;  // day of week in 0-6
        //var letterofweek; // letter for day of week
        //var timehhmm;  // hhmm in 24 hour format
        //var month;  // month 1-12. note starts with 1
        //var day; // day of month 1-31
        //var year; // year nnnn
        //var monthday; // mmdd
        //var laborday; // first monday in sept.  we need to compute this dyanmically
        //var memorialday;  // last monday in may
        //var thanksgiving;
        //var holiday;  // true if  holiday
        var updateMinutes; // minutes since last update

        /////////////////////////////////////////////////////////////////////////////////////////
        // load web pages
        function ShowFerry() {
            window.open("http://www.co.pierce.wa.us/index.aspx?NID=1793");
        }

        //function ShowFerrySchedule() {
        //    window.open("localferryschedule.html");
        //    //window.open("http://www.co.pierce.wa.us/index.aspx?NID=2200");
        //}
        function ShowFerryCams() {
            window.open("ferrywebcams.html");
        }
        //function ShowComingEvents() {
        //    window.open("comingevents.html"); //("http://www.andersonislandcc.org/calendar/");
        //}
        // query for tide times at noaa
        function ShowTides() {
             window.open("tides.html");
        }
        // query for tide times at noaa
        function ShowWeather() {
            window.open("aiweather.html");
        }
        function ShowMap() {
            window.open("https://www.google.com/maps/place/Anderson+Island,+Washington+98303/@47.1559337,-122.7429194,13z/data=!3m1!4b1!4m2!3m1!1s0x5491a7e3857e1e6f:0x9800502f110113b4")
        }
        
        function ShowBurnBan() {
            window.open("http://www.pscleanair.org/priorities/woodheating/Pages/burnbans.aspx")
        }

        function LocalMenu() {

        }

        /////////////////////////////////////////////////////////////////////////////////////////
        // return the next ferry time as a string. ferrytimes is the array of times and days;
        function FindNextFerryTime(ferrytimes) {
            ferrytimes = ferrytimes.split(",");
            InitializeDates(0);
            var i;
            // roll through the ferry times, skipping runs that are not valid for today
            for (i = 0; i < ferrytimes.length; i = i + 2) {
                if (timehhmm >= ferrytimes[i]) continue;  // skip ferrys that have alreaedy run
                // now determine if the next run will run today.  If it is a valid run, break out of loop.
                if (ValidFerryRun(ferrytimes[i + 1])) break;
            }

            // we ran out of the schedule today so give the 1st run for tomorrow
            if (i >= ferrytimes.length) {
                i = 0;
                // need to compute if tomorrow is a holiday
                if (!IsHoliday(monthday + 1) && (dayofweek == 6)) i = 2; // special case kludge. on saturday, start sunday at 
            }

            // convert to a string and add am or pm and optionally tomorrow
            var ft;
            ft = ShortTime(ferrytimes[i]);
            if (ferrytimes[i] < timehhmm) ft = ft + " tomorrow";
                
            else {
                ft = ft + " (in " + timeDiff(timehhmm, ferrytimes[i]) + ")";
            }
            return ft;
        }

        /////////////////////////////////////////////////////////////////////////////////////////
        // Finds the next ferry times and puts them into the Dom.
        function WriteNextFerryTimes() {
            // ferrytimes = time in 24 hours, S=Steilacoom, A=Anderson Island, 
            // ferrydays:  *=always, H=holiday, 0-6=days of week, AFXY=special rules H=(12/31,1/1,Mem day, 7/3,7/4,labor day,thanksgiving, 12/24,12/25),F=Fuel run 1,3 Wednesday, X=Friday Only labor day-6/30, Y=Fridays only 7/1=labor day
            //var ferrytimeS = [545, "H123456A", 645, "*", 800, "*", 900, "*", 1000, "F", 1200, "*", 1410, "*", 1510, "*", 1610, "*", 1710, "*", 1830, "*", 1930, "*", 2040, "4560H", 2200, "X6H", 2300, "Y"];
            //var ferrytimeA = [615, "H123456A", 730, "*", 830, "*", 930, "*", 1030, "F", 1230, "*", 1440, "*", 1540, "*", 1640, "*", 1740, "*", 1900, "*", 2000, "*", 2110, "4560H", 2230, "X6H", 2330, "Y"];
            // at this point, i = the next valid ferry run
            var v;
            v = "Next Steilacoom: ";
            if (holiday) v = "Hoilday Steilacoom: "
            var lftS = localStorage.getItem("ferrytimess");
            if (lftS === null) lftS = "545,H123456A,645,*,800,*,900,*,1000,F,1200,*,1410,*,510,*,1610,*,1710,*,1830,*,1930,*,2040,4560H,2200,X6H,2300,Y";
            var lftA = localStorage.getItem("ferrytimesA");
            if (lftA === null) lftA = "615,H123456A,730,*,830,*,930,*,1030,F,1230,*,1440,*,1540,*,1640,*,1740,*,1900,*,2000,*,2110,4560H,2230,X6H,2330,Y";

            v = v + FindNextFerryTime(lftS) + "; AI: " + FindNextFerryTime(lftA);
            document.getElementById("ferrytimes").innerHTML = v;

        }

        /////////////////////////////////////////////////////////////////////////////////////////
        // ShowOpenHours - shows whether something is open or closed
        function ShowOpenHours() {
            // openHours format is array of strings, 1 string per business Defined in AIA.js.
            // each string is: name (phone),Suntime,Montime,Tuetime,Wedtime,Thurtime,Fritime,Sattime,closedholidays
            //   where xxxtime = hhmm-hhmm in 24 hour format. closedholidays = mmdd/mmdd/mmdd...
            var j;
            var openlist;
            var a;
            var store;
            var opentimetoday, opentime, closetime;
            var openHours;
            if (localStorage.getItem("openhours")===null) return;
            openHours = localStorage.getItem("openhours");
            if(openHours === null) return;
            if(openHours == "") return;
            openHours = openHours.split("\n");
            openlist = "";

            // loop through the openHours array (each string entry is one business)
            for (var i = 0; i < openHours.length-1; i++) {
                a = openHours[i].split(",");  // parse it into an array
                store = a[0].split("("); // strip out phone number
                openlist += store[0] + ":";
                opentimetoday = a[dayofweek + 1]; // hhmm-hhmm open today
                opentime = Number(opentimetoday.substring(0,4)); // open time hhmm
                closetime = Number(opentimetoday.substring(5, 9)); // close time hhmm
                // test for closed
                if (opentimetoday = "" || (timehhmm > closetime) || (timehhmm < opentime)) {
                    openlist += " <span style='color:darkred'> Closed. </span>";
                    if (timehhmm < opentime) {
                        openlist += " Opens today at " + ShortTime(opentime) + "<br/>";
                        continue;
                    }
                    // find next open time
                    j = dayofweek + 1; if (j == 7) j = 0;
                    // if it opens tomorrow
                    if (a[j + 1] != "") {  
                        openlist += " Opens tomorrow at " + ShortTime(a[j + 1].substring(0, 4)) + "<br/>";
                        continue;
                    }
                    // not open tomorrow. find next open day.
                    while (true) {
                        j++;  if (j == 7) j = 0; // handle day rollover
                        if (a[j + 1] != "") { // open day found
                            openlist += " Opens " + dayofweekname[j] + " at " + ShortTime(a[j + 1].substring(0, 4)) + "<br/>";
                            break;
                        }
                    } // while loop
                    
                } else {
                    // its open
                    openlist += " <span style='color:green'> Open </span>till " + ShortTime(closetime) + " today<br/>";
                }
            } // end for
            return openlist;
        }

        //////////////////////////////////////////////////////////////////////////////////////////////////////
        // getCurrentWeather  
        function getCurrentWeather() {
            $.ajax({
                url: 'http://api.aerisapi.com/observations/98303?client_id=U7kp3Zwthe8dc19cZkFUz&client_secret=4fHoJYS6m9T7SERu7kkp7iVwE0dewJo5zVF38tfW',
                dataType: 'jsonp',
                success: function (json) {
                    if (json.success == true) {
                        //alert("json success");
                        // pick out the return variables
                        var r = json.response.ob;
                        var current =  r.tempF + "&degF, " + r.weather + ", " +  r.windDir + " " + r.windMPH + " mph " +
                            ", " + r.precipIN + " precip."
                        //document.getElementById("forecast").innerHTML = current;
                        $("#weather").html(current); // jquery equivalent. Is this really easier?
                    }
                    else {
                        alert('An error occurred: ' + json.error.description);
                    }
                }
            });
        } // end of function

        //////////////////////////////////////////////////////////////////////////////////////////////////////////
        // getForecast
        // get weather data using the aeris api and returning a jsonp structure. This is the only way to get data from a different web site.
        // License as of 2/8/16 is for 750 hits/day for free.
        function getForecast() {
            $.ajax({
                url: 'http://api.aerisapi.com/forecasts/98303?client_id=U7kp3Zwthe8dc19cZkFUz&client_secret=4fHoJYS6m9T7SERu7kkp7iVwE0dewJo5zVF38tfW',
                dataType: 'jsonp',
                success: function (json) {
                    if (json.success == true) {
                        var r = json.response[0].periods[0];
                        $("#forecast").html("Forecast: Hi " + r.maxTempF + "&deg, Lo " + r.minTempF + "&deg, " + r.weather);
                    }
                    else {
                        alert('An error occurred: ' + json.error.description);
                    }
                }
            });  // end of ajax call
        }  // end of function


        /////////////////////////////////////////////////////////////////////////////////////////////
        // get tide data using the aeris api and returning a jsonp structure. This is the only way to get data from a different web site.
        // License as of 2/8/16 is for 750 hits/day for free.
        function ShowNextTides() {
            var hilow;
            var nextTides;
            var oldtide = -1;
            var json = localStorage.getItem("jsontides");
            if (json === null) return;
            var periods = JSON.parse(json); // parse it
            // roll through the reply in jason.response.periods[i]
            var i;
            for (i = 0; i < periods.length; i++) {
                var thisperiod = periods[i];
                var m = Number(thisperiod.dateTimeISO.substring(5, 7));
                var d = Number(thisperiod.dateTimeISO.substring(8, 10));
                var h = Number(thisperiod.dateTimeISO.substring(11, 13)); // tide hour
                var mi =Number(thisperiod.dateTimeISO.substring(14, 16));  // time min
                var tidehhmm = ((h) * 100) + (mi);
                if (thisperiod.type == 'h') hilow = '&nbsphigh';
                else hilow = '&nbsplow';
                // if tide is past, color row gray
                if ((month > m) || (month == m && dayofmonth > d) || (month == m && dayofmonth == d && (timehhmm > tidehhmm))) {
                    oldtide = 0;
                } else if (oldtide != 1) {
                    nextTides = "Next: " + hilow + " " + thisperiod.heightFT + " ft. at " + ShortTime(tidehhmm) + ";";
                    oldtide = 1;
                } else if (oldtide == 1) {  // save next tide
                    nextTides += hilow + " " + thisperiod.heightFT + " ft. at " + ShortTime(tidehhmm) + ";";
                    document.getElementById("tides").innerHTML = nextTides;
                    return;
                }
            }
         }

        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        // getTideData - call the aeri api and store the response as a local storage string
        //
        function getTideData() {
            var hilow;
            var nextTides;
            var oldtide = -1;
            $.ajax({
                url: 'http://api.aerisapi.com/tides/9446705?client_id=U7kp3Zwthe8dc19cZkFUz&client_secret=4fHoJYS6m9T7SERu7kkp7iVwE0dewJo5zVF38tfW&from=-20hours&to=+48hours',
                dataType: 'jsonp',
                success: function (json) {

                    if (json.success == true) {
                        localStorage.setItem("jsontides", JSON.stringify(json.response.periods)); // store the full json structure
                        localStorage.setItem("tidestime", monthday);
                        ShowNextTides();
                    } else {
                    }
                }
            });
        }

      
        ////////////////////////////////////////////////////////////////////////////////////////////
        // DisplayNextEvent


        ///////////////////////////////////////////////////////////////////////////////////////////////
        // DisplayComingEvents - display the events in the 'comingevents'  or 'comingactivities' local storage object
        //  object consists of rows (separated by /n) 1 for each event or activity
        function DisplayNextEvents(CE){
            var datefmt; // formatted date
            var iCE; // iterator through CE
            var aCE; // CE split array 
            if(CE===null)return;
            CE = CE.split("\n");  // break it up into rows
            if (CE == "") return;
            // roll through the next 30 days
            for (iCE = 0; iCE < CE.length; iCE++) {
                aCE = CE[iCE].split(';');  // split the string
                //  advance schedule date to today
                if(Number(aCE[0]) < monthday ) continue; // not there yet
                if(Number(aCE[0]) == monthday && Number(aCE[2]) < timehhmm ) continue; // not there yet
                // found it
                if (Number(aCE[0]) == monthday) datefmt = "Today";
                else if (Number(aCE[0]) == (monthday+1)) datefmt = "Tomorrow";
                else if (GetDayofWeek(aCE[0]) > dayofweek) { datefmt = dayofweekshort[GetDayofWeek(aCE[0])]; }
                else datefmt = dayofweekshort[GetDayofWeek(aCE[0])] + " " + aCE[0].substring(0, 2) + "/" + aCE[0].substring(3, 5);
                return datefmt + " " + ShortTime(aCE[1]) + "-" + ShortTime(aCE[2]) + " " + aCE[4] + " at " + aCE[5];
            }
        }


        ///////////////////////////////////////////////////////////////////////////////////////////////
        //  GetComingEvents - retrieves the coming events into the comingevents local storage object
        //  Load from server using ajax async request.
        //  Store into local cache at 'comingevents' and 'comingactivities'  monthday of load stored into local cache at 'comingeventsloaded'
        function GetComingEvents() {
            // ajax async request
            //$.get("comingevents.txt", ComingEventsReceived());
            $.ajax({
                url: "comingevents.txt",
                success: function (data) {
                    //alert("Data: " + data + "\nStatus: " + status);
                    var i = data.indexOf("ACTIVITIES");
                    if(i==0) i=data.length; 
                    localStorage.setItem("comingevents", data.substring(0, i));
                    if(i<data.length) localStorage.setItem("comingactivities", data.substring(i+11, data.length));
                    localStorage.setItem("comingeventsloaded", monthday); // save event loaded date/time
                    //alert("coming events loaded at " + monthday);
                    $("#nextevent").html(DisplayNextEvents(localStorage.getItem("comingevents")));
                    $("#nextactivity").html(DisplayNextEvents(localStorage.getItem("comingactivities")));
                }
            });
            //alert("comingevents.txt requested");
            return;
        }

        ///////////////////////////////////////////////////////////////////////////////////////////////
        //  GetDailyCache - retrieves the daily cache into the local storage objects 
        //  Load from server using ajax async request.
        //  Store into local cache at 'comingevents'.  monthday of load stored into local cache at 'comingeventsloaded'
        function GetDailyCache() {
            // ajax async request
            $.ajax({
                url: "dailycache.txt",
                success: function (data) {
                    ReloadDailyCache(data);
                    localStorage.setItem("dailycacheloaded", monthday); // save event loaded date/time
                    //alert("coming events loaded at " + monthday);
                }
            });
            //alert("comingevents.txt requested");
            return;
        }

        ////////////////////////////////////////////////////////////////////////////////////////
        // ReloadDailyCache - parses the daily cache into its parts in local storage
        function ReloadDailyCache(data) {
            data = data.replace(/\r/g, ""); // remove all crs regular expression with global flag
            var rows = data.split("\n"); //split into lines
            if (rows[0] != "DAILYCACHE") {
                alert("could not load updated values for ferry times and open hours");
                return;
            }
            //alert("loading daily cache");
            localStorage.setItem("dailycacheloaded", monthday); // remember date time
            for (var i = 0; i < rows.length; i++) {
                //alert("'" + rows[i] + "'");
                switch (rows[i]) {
                    case "FERRYTIMESS": // steilacoom times
                        localStorage.setItem("ferrytimess", rows[i+1]);
                        i++;
                        break;
                    case "FERRYTIMESA":  // AI times
                        localStorage.setItem("ferrytimesa", rows[i+1]);
                        i++;
                        WriteNextFerryTimes();
                        break;
                    case "SCHEDULEDATE":  // ferry schedule date
                        localStorage.setItem("scheduledate", rows[i+1]);
                        i++;
                        break;
                    case "OPENHOURS":  // form a single concatenated 
                        i++;
                        var openh = "";
                        while ((i < rows.length) && (rows[i] != "OPENHOURSEND")) {
                            openh += rows[i] + "\n";
                            i++;
                        }
                        localStorage.setItem("openhours", openh);
                        i++;
                        ShowOpenHours();
                        break;
                    case "LINKS":
                }
            }
        }
        /////////////////////////////////////////////////////////////////////////////////////
        //  update all data on a regular basis
        //  also redisplay the next ferry times every minute
        function timerUp() {
            updateMinutes = Number(localStorage.getItem("updateminutes"));
            // everything you want to do every minute. These all go against localStorage strings, so no query

            WriteNextFerryTimes();
            ShowNextTides(); // .
            ShowOpenHours();

            // reload daily stuff - ferry schedule, store hours, coming events, tides
            var dailycacheloaded = localStorage.getItem("dailycacheloaded");
            if ((dailycacheloaded!=null) && (Number(dailycacheloaded) != monthday)) {
                GetDailyCache();  // don't reload data on same day
                GetComingEvents();
                getTideData();
            }

            // everything you want to do every 5 minutes
            if ((updateMinutes % 5) == 0) {
                DisplayNextEvents();
            }

            // everything you want to do every 15 minutes
            if ((updateMinutes % 15)==0) {
                getCurrentWeather();
            }

            // everything you want to do every 30 minutes
            if ((updateMinutes % 30) == 0) {
                getForecast();
            }
            updateMinutes++; // do this last so the focus event will run all of these but really we should use the actual elapsed time, not a counter
            localStorage.setItem("updateminutes", updateMinutes);
        }

        /////////////////////////////////////////////////////////////////////////////
        // focus and blur events
        function focusEvent() {
            setInterval("timerUp()", 60000);  // timeout in milliseconds. currently 60 seconds
            localStorage.setItem("updateminutes", "0");
            timerUp();
        }
        function blurEvent() {
            clearInterval(0); // TURN OFF TIMER WHEN FOCUS IS LOST
         }

    </script>

    <!-- actual javascript execution begins here:-->
    <script type="text/javascript">
        app.initialize();
        InitializeDates(0);
        updateMinutes = 0;
        localStorage.setItem("updateminutes", "0");
        WriteNextFerryTimes();
        ShowOpenHours(); //  open hours

        // display next event. reload the 'comingevent' cache if the day has changed.
        $("#nextevent").html(DisplayNextEvents(localStorage.getItem("comingevents")));
        $("#nextactivity").html(DisplayNextEvents(localStorage.getItem("comingactivities")));
        var comingeventloaded = localStorage.getItem("comingeventsloaded");
        if (comingeventloaded==null || comingeventloaded != monthday) GetComingEvents();  // don't reload data on same day
        GetComingEvents();

        document.getElementById("openhours").innerHTML = ShowOpenHours(); //  open hours
        setInterval("timerUp()", 60000);  // timeout in milliseconds. currently 60 seconds
        getCurrentWeather(); // gets weather async
        getForecast(); // gets forecast async
        getTideData(); // gets tides async

        //reload the 'dailycache' cache if the day has changed.
        var dailycacheloaded = localStorage.getItem("dailycacheloaded");
        //if (dailycacheloaded != monthday) GetDailyCache();  // don't reload data on same day
        GetDailyCache();//////////////////////////////////////debug
        window.addEventListener("focus", focusEvent);
        window.addEventListener("blur", blurEvent);
    </script>
</body>
</html>

