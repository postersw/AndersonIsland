<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
     <meta name="format-detection" content="telephone=no" />
     <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
     <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=medium-dpi" />
     <link rel="stylesheet" type="text/css" href="css/index.css" />
     <title>AI Weather</title>
     <style>
            button {font-size: 12px;}
            p {font-size:12px;}
      </style>


</head>
<body>
    <div class="app">
    <h1>Anderson Island Weather</h1>


    <div id="divTable">
    <p id="forecast">Please wait for the forecast...</p>
    </div>
</div>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript" src="js/AIA.js"></script>
    <script type="text/javascript">


        
        /////////////////////////////////////////////////////////////////////////////////////////
        // create the ferry schedule table
        //  creates the global 'table'
        function createTable() {
            // Create table.
            table = document.createElement('table');
            table.style.border = "thin solid black";
            table.style.borderCollapse = "collapse";
            // Insert New Row for table at index '0'.
            var row1 = table.insertRow(0);
            // Insert New Column for Row1 at index '0'.
            var row1col1 = row1.insertCell(0);
            row1col1.style.backgroundColor = "black";
            row1col1.style.color = "white";
            row1col1.innerHTML = 'Date';
            // Insert New Column for Row1 at index '1'.
            row1col1 = row1.insertCell(1);
            row1col1.style.backgroundColor = "black";
            row1col1.style.color = "white";
            row1col1.innerHTML = '|Hi&nbsp';
            row1col1 = row1.insertCell(2);
            row1col1.style.backgroundColor = "black";
            row1col1.style.color = "white";
            row1col1.innerHTML = '|Lo&nbsp';
            row1col1 = row1.insertCell(3);
            row1col1.style.backgroundColor = "black";
            row1col1.style.color = "white";
            row1col1.innerHTML = '|Forecast&nbsp';
        }

        /////////////////////////////////////////////////////////////////////////////////////////////
        // get weather data using the aeris api and returning a jsonp structure. This is the only way to get data from a different web site.
        // License as of 2/8/16 is for 750 hits/day for free.
        //  fromdate = optional starting date for the weather
        function getWeather(fromdate) {
            var olddate, newdate; // dates
            var ampm; // am or pm
            var currentTemp;

            //$("#tideButton").hide();  // hide the user button

            $.ajax({
                url: 'http://api.aerisapi.com/forecasts/98303?client_id=U7kp3Zwthe8dc19cZkFUz&client_secret=4fHoJYS6m9T7SERu7kkp7iVwE0dewJo5zVF38tfW',
                dataType: 'jsonp',
                success: function (json) {

                    if (json.success == true) {

                        //debug - display the return
                        //alert("json success");
                        //var output;
                        //output = JSON.stringify(json);
                        //alert(output);
                        // document.getElementById("forecast").innerHTML = output;

                        var resp = json.response[0].periods;
                        var mydayofweek = dayofweek;
                        // roll through the reply in jason.response.periods[i]
                        for (var i = 0; i < resp.length; i++) {
                            // if date changed, add a blank row
                            var r = resp[i];

                            // Insert New Row for table at end of table.
                            var row1 = table.insertRow(-1);

                            // Insert New Column for date
                            var row1col1 = row1.insertCell(0);
                            var m = r.dateTimeISO.substring(5, 7);
                            var d = r.dateTimeISO.substring(8, 10);
                            //row1col1.innerHTML = m + "/" + d + '&nbsp';
                            row1col1.innerHTML = dayofweekname[mydayofweek].substring(0, 3);
                            mydayofweek++; if (mydayofweek > 6) mydayofweek = 0;
                            row1col1.style.border = "thin solid black";

                            // high
                            row1col1 = row1.insertCell(1);
                            row1col1.innerHTML = r.maxTempF + "&deg";
                            row1col1.style.border = "thin solid black";
                            // low
                            row1col1 = row1.insertCell(2);
                            row1col1.innerHTML = r.minTempF + "&deg";
                            row1col1.style.border = "thin solid black";
                            // weather
                            row1col1 = row1.insertCell(3);
                            row1col1.innerHTML = r.weather;
                            row1col1.style.border = "thin solid black";
                        }  // for end

                    }
                    else {
                        alert('An error occurred: ' + json.error.description);
                    }

                }

            });  // end of ajax call
        }  // end of function

            /////////////////////////////////////////////////////////////////////////////////////////////
            // get current weather observation data using the aeris api and returning a jsonp structure. This is the only way to get data from a different web site.
            //for documentation see: http://www.aerisweather.com/support/docs/api/reference/endpoints/observations/
            // License as of 2/8/16 is for 750 hits/day for free.
            function getCurrentWeather() {

                $.ajax({
                    url: 'http://api.aerisapi.com/observations/98303?client_id=U7kp3Zwthe8dc19cZkFUz&client_secret=4fHoJYS6m9T7SERu7kkp7iVwE0dewJo5zVF38tfW',
                    dataType: 'jsonp',
                    success: function (json) {
                    
                        if (json.success == true) {

                            // pick out the return variables
                            var r = json.response.ob;
                            var current = "Currently " + r.weather + ", " + r.tempF + "&degF, " + r.humidity + "% RH, wind " + r.windDir + " " + r.windMPH + " mph " +
                                ", " + r.precipIN + " in. rain, " +
                                "<br/>Sunrise at " + r.sunriseISO.substring(11, 19) + ", Sunset at " + r.sunsetISO.substring(11, 19);
                            //document.getElementById("forecast").innerHTML = current;
                            $("#forecast").html(current); // jquery equivalent. Is this really easier?

                        }
                        else {
                            alert('An error occurred: ' + json.error.description);
                        }

                    }

                });
            
        } // end of function
        </script>

        <!-- actual javascript execution begins here:-->
        <script type="text/javascript">
            /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            // run the script
            InitializeDates(0);
            getCurrentWeather();
            createTable();
            getWeather("today");
            var div = document.getElementById('divTable');
            div.appendChild(table);
           
    </script>

</body>
</html>