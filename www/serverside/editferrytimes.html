<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>AIA: Edit Ferry Schedule</title>
</head>
<body>
<h1>EDIT FERRY SCHEDULE</h1>
    Ferry Schedule Editor.
    <p>Use this page to edit the ferry schedule. </p>
    <button onclick="LoadSchedule()">Load from dailycache</button>
    <button onclick="CheckSchedule()"> Check </button>
    <button onclick="TestSchedule()"> Test </button>
    <button onclick="SaveSchedule()"> Save </button>
    <p>Rules for ferry time expression:<br/>
    <ul>
        <li>Times are 2400, NO leading zero. 0=midnight. 1200=noon.</li>
        <li>* = runs every day.</li>
        <li>0123456 = day of week to run. 0=Sunday. 6=Saturday. Multiple days are allowed, e.g. 135</li>
        <li>(xxxxx) = a javascript expression that evaluates to TRUE/FALSE. TRUE = run.  FALSE = skip.</li>
        <li>Allowable variables: mmdd, mmddyear, dayofmonth, weekofmonth, month, dayofweek</li>
        <li>Allowable functions: any javascript function, plus any function in AIA.</li>
        <li>Most useful function:  InList(variabletotest, l1, l2, ...).  Returns TRUE if variabletotest is l1 or l2 or ... Can take any number of list elements.</li>
        <li>RFB. 6/3/18.</li>              
        </ul>
    <h1>EDIT AREA</h1>
    <label>mmdd</label><input type="number" id="monthday" size="4"/>
    <label>dayofweek</label><input type="number" id="dayofweek" size="1"/>
    <label>weekofmonth</label><input type="number" id="weekofmonth" size="1"/><br />
    <input type="text" id="edittime" size="4" /> &nbsp;<input type="text" size="1" id="editSAK" /> &nbsp; &nbsp;
    <button onclick="CheckEdit()">Check</button> 
    <button onclick="PCountEdit()">() Count</button> 
    <button onclick="SaveEdit()">Save</button><br/>
    <textarea cols="200" rows="4" id="editrule"></textarea>

    <h1>SCHEDULE TABLE</h1>
    <table id="ftable">
            <tr><td>STEIL</td><td>rule</td><td>status</td><td>AI</td><td>Rule</td><td>Status</td><td>KETR</td><td>Rule</td><td>Status</td></

    </table>
    

<script>

    // Ferry run times and flags. 
    //  These values are valid as of 9/2016 - but are immediately overridden by data in dailycache.txt:
    //  FERRYTS,FERRYTA,FERRYTK,FERRYTS2,FERRYTA2,FERRYTK2   (read in by ParseDailyCache)Heirarchy is:
    //  1. '*' overrides everything and means always.
    //  2. 0-6 = day of week that run is valid on.
    //  3. Starts with a '(': it is the special case rules run with 'eval'

    var ferrytimeS = [445, "((gDayofWeek>0)&&(gDayofWeek<6)&&!InList(gMonthDay,1225,101,704,thanksgiving))", 545, "123456", 645, "*", 800, "*", 900, "*", 1000, "((gDayofWeek!=3)||!InList(gWeekofMonth,1,3))", 1200, "*", 1420, "*", 1520, "*", 1620, "*", 1730, "*", 1840, "*", 2040, "*", 2200, "( (gDayofWeek==6)|| ((gDayofWeek==5)&&!((gMonthDay>=701)&&(gMonthDay<=laborday))) ||InList(gMonthDay,1231,101,memorialday,703,704,laborday,thanksgiving,1224,1225))", 2300, "((gDayofWeek==5)&&(gMonthDay>=701)&&(gMonthDay<=laborday))"];
    var ferrytimeA = [515, "((gDayofWeek>0)&&(gDayofWeek<6)&&!InList(gMonthDay,1225,101,704,thanksgiving))", 615, "123456", 730, "*", 830, "*", 930, "*", 1030, "((gDayofWeek!=3)||!InList(gWeekofMonth,1,3))", 1230, "*", 1450, "*", 1550, "*", 1650, "*", 1800, "*", 1910, "*", 2110, "*", 2230, "( (gDayofWeek==6)|| ((gDayofWeek==5)&&!((gMonthDay>=701)&&(gMonthDay<=laborday))) ||InList(gMonthDay,1231,101,memorialday,703,704,laborday,thanksgiving,1224,1225))", 2330, "((gDayofWeek==5)&&(gMonthDay>=701)&&(gMonthDay<=laborday))"];
    var ferrytimeK = [0, "", 0, "", 655, "*", 0, "", 0, "", 1010, "((gDayofWeek==2)&&InList(gWeekofMonth,1,3))", 1255, "*", 0, "", 0, "", 0, "", 0, "", 1935, "*", 0, "", 2250, "( (gDayofWeek==6)|| ((gDayofWeek==5)&&!((gMonthDay>=701)&&(gMonthDay<=laborday))) ||InList(gMonthDay,1231,101,memorialday,703,704,laborday,thanksgiving,1224,1225))", 2350, "((gDayofWeek==5)&&(gMonthDay>=701)&&(gMonthDay<=laborday))"];
    var ferrytimeS2 = [445, "((gDayofWeek>0)&&(gDayofWeek<6)&&!InList(gMonthDay,1225,101,704,thanksgiving))", 545, "123456", 645, "*", 800, "*", 900, "*", 1000, "((gDayofWeek!=3)||!InList(gWeekofMonth,1,3))", 1200, "*", 1230, 50, 1350, 50, 1420, "*", 1450, 50, 1520, "*", 1550, 50, 1620, "*", 1650, 50, 1730, "*", 1800, 50, 1840, "*", 2040, "*", 2200, "( (gDayofWeek==6)|| ((gDayofWeek==5)&&!((gMonthDay>=701)&&(gMonthDay<=laborday))) ||InList(gMonthDay,1231,101,memorialday,703,704,laborday,thanksgiving,1224,1225))", 2300, "((gDayofWeek==5)&&(gMonthDay>=701)&&(gMonthDay<=laborday))"];
    var ferrytimeA2 = [515, "((gDayofWeek>0)&&(gDayofWeek<6)&&!InList(gMonthDay,1225,101,704,thanksgiving))", 615, "123456", 730, "*", 830, "*", 930, "*", 1030, "((gDayofWeek!=3)||!InList(gWeekofMonth,1,3))", 1230, "*", 1300, 50, 1420, 50, 1450, "*", 1520, 50, 1550, "*", 1620, 50, 1650, "*", 1730, 50, 1800, "*", 1840, 50, 1910, "*", 2110, "*", 2230, "( (gDayofWeek==6)|| ((gDayofWeek==5)&&!((gMonthDay>=701)&&(gMonthDay<=laborday))) ||InList(gMonthDay,1231,101,memorialday,703,704,laborday,thanksgiving,1224,1225))", 2330, "((gDayofWeek==5)&&(gMonthDay>=701)&&(gMonthDay<=laborday))"];
    var ferrytimeK2 = [0, "", 0, "", 655, "*", 0, "", 0, "", 1010, "((gDayofWeek==2)&&InList(gWeekofMonth,1,3))", 1255, "*", 0, "", 0, "", 0, "", 0, "", 0, "", 0, "", 0, "", 0, "", 0, "", 0, "", 1935, "*", 0, "", 2250, "( (gDayofWeek==6)|| ((gDayofWeek==5)&&!((gMonthDay>=701)&&(gMonthDay<=laborday))) ||InList(gMonthDay,1231,101,memorialday,703,704,laborday,thanksgiving,1224,1225))", 2350, "((gDayofWeek==5)&&(gMonthDay>=701)&&(gMonthDay<=laborday))"];

    var gFerryDate2 = 0;  // cutover time to ferrytimex2
    var geditSAK = "";
    var gediti = 0;

    // global dates
    var gDayofWeek = 1;
    var gMonthDay = 202;
    var gWeekofMonth = 2;
    var laborday = 901;
    var memorialday = 531;
    var thanksgiving = 1122;
   

    //////////////////////////////////////////////////////////////////////////
    // Load the schedule from dailycache.text  (local or web)
    // Reads dailycache, extracts the ferry times, and builds the table
    //  Entry   dailycache.txt is a local file, or it can retrieve it from the web site
    //  Exit    ftable built
    function LoadSchedule() {
        GetDailyCache();
    }

    //////////////////////////////////////////////////////////////////////////
    // Check Schedule - checks the syntax of each row, per the rules above
    //  Entry:  ftable = the schedule table
    //  Exit:   bad rows colored red.
    //
    function CheckSchedule() {

    }

    ////////////////////////////////////////////////////////////////////////////
    //  TestSchedule - prompts for a date/time, and then runs the rules
    //  Entry   ftable = the schedule table
    //  Exit    none
    function TestSchedule() {


    }

    //////////////////////////////////////////////////////////////////////////////
    //  SaveSchedule - saves the schedule rows to a local file. OR 
    //      replaces the current schedule rows in dailycache.txt with the new rows
    //  Entry   ftable = the schedule table
    //  Exit
    function SaveSchedule() {

    }


    //------------------------------------------------------------------------------------------------


    ///////////////////////////////////////////////////////////////////////////////////////////////
    //  GetDailyCache - retrieves the daily cache into the local storage objects 
    //  Load from server using ajax async request.
    //  FERRYTIMESS,FERRYTIMESA,OPENHOURS,OPENHOURSEND,EMERGENCY,EMERGENCYEND
    //function GetDailyCache() {
    //     ajax async request
    //    var myurl = FixURL("dailycache.txt"); 
    //    $.ajax({
    //        url: myurl, // for phone use fully qualified url http://anderson-island.org/
    //        success: function (data) {
    //}
    function GetDailyCache() {
        // ajax async request
        ////var myurl = FixURL("dailycache.txt");

        //var myurl = FixURL("getdailycache.php?VER=" + gVer + "&KIND=" + DeviceInfo() + "&N=" + localStorage.getItem("Cmain") +
        //    "&P=" + LSget("pagehits").substr(0, 30));
        //var myurl = FixURL("getdailycachetest.php?VER=" + gVer + "&KIND=" + DeviceInfo() + "&N=" + localStorage.getItem("Cmain") +
        //   "&P=" + LSget("pagehits").substr(0, 30));
        var myurl = "http://www.anderson-island.org/dailycache.txt";
        // ajax request without jquery
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (xhttp.readyState == 4 && xhttp.status == 200) HandleDailyCacheReply(xhttp.responseText);
        }
        xhttp.open("GET", myurl, true);
        xhttp.send();
    }
    function HandleDailyCacheReply(data) {
        
        ParseDailyCache(data);
    }

    ////////////////////////////////////////////////////////////////////////////////////////
    // ParseDailyCache - parses the daily cache into its parts in local storage
    // data is demarkated by 
    //  KEYWORD\n data   \n      OR
    //  KEYWORD\n  data with embedded newlines \n KEYWORDEND

    function ParseDailyCache(data) {
        var s;

        data = data.replace(/\r/g, ""); // remove all crs regular expression with global flag
        //var rows = data.split("\n"); //split into lines
        if (data.substring(0, 10) != "DAILYCACHE") {
            //alert("could not load updated values for ferry times and open hours");
            //document.getElementById("reloadreason").innerHTML = "Could not load dailycache data.";
            alert("Could get dailycache.txt");
            return;
        }

        //localStorage.setItem("dailycacheloaded", gMonthDay); // remember date time
        //parseCache(data, "ferrytimess", "FERRYTIMESS", "\n");
        //parseCache(data, "ferrytimesa", "FERRYTIMESA", "\n");
        //parseCache(data, "ferrytimesk", "FERRYTIMESK", "\n");
        parseCache(data, "ferrytimess", "FERRYTS", "\n");
        parseCache(data, "ferrytimesa", "FERRYTA", "\n");
        parseCache(data, "ferrytimesk", "FERRYTK", "\n");
        // fill ferry arrays
        ParseFerryTimes();
        BuildFerrySchedule(ferrytimeS, ferrytimeA, ferrytimeK);
        alert("Loaded " + ferrytimeA.length + " entries.");
        
    }

    /////////////////////////////
    // parseCache - returns the string from the daily cache
    //  data is in the form:  <startstr>\n data <endstr>
    //  localstoragename = name of local storage item, "" to not store it
    //  startstr = starting string, endstr = ending string. can be "\n"
    //  exit    returns the string. "" if no string.
    // Modified 5/15/18 to always check for <startstr>\n and return error if not found.
    function parseCache(data, localstoragename, startstr, endstr) {
        //var s = data.indexOf(startstr);
        var s = data.indexOf(startstr + "\n");  //This should work more reliably but i'm afraid of the \n on nonwindows
        //if (s < 0) return "";
        if (s < 0) {
            alert("ERROR in DailyCache startstr: Cant find " + startstr);
            return "";
        }
        var e = data.indexOf(endstr, s + startstr.length + 1);
        //if (e < 0) return "";
        if (e < 0) {
            alert("ERROR in DailyCache endstr: Cant find " + endstr);
            return "";
        }
        var str = data.substring(s + startstr.length + 1, e);
        if (localstoragename != "") localStorage.setItem(localstoragename, str);
        return str;
    }


    ////////////////////////////////////////////////////////////////////////
    //  ParseFerryTimes - convert the ferrytimesx strings into arrays ferrytimeX
    //      which is a mixed array of runtime(number);rules(string); runtime; rules, ...
    //      works on ver 1.7 data.  ignores comma delimited ver 1.5 data.
    //  Entry   localStorage items ferrytimesxx are set
    //  Exit    arrays ferrytimexx are set 
    function ParseFerryTimes() {
        ferrytimeS = FillFerryArray("ferrytimess");
        ferrytimeA = FillFerryArray("ferrytimesa");
        ferrytimeK = FillFerryArray("ferrytimesk");
        if (ferrytimeS.length != ferrytimeA.length) alert("different number of entries for S and A!");
        if (ferrytimeS.length != ferrytimeK.length) alert("different number of entries for S and K!");

        //ferrytimeS2 = FillFerryArray("ferrytimess2");
        //ferrytimeA2 = FillFerryArray("ferrytimesa2");
        //ferrytimeK2 = FillFerryArray("ferrytimesk2");

        //str = localStorage.getItem("ferrydate2");
        //if (IsEmpty(str)) return;
        //var d = new Date(str);  // convert ferry date 2 to ms
        //gFerryDate2 = d.getTime(d); // ms till cutover
    }

    // Helper - convert ferry times from string to number, so "0800" becomes 800
    //  remember that the ferry time is every other entry in each array
    //  exit    returns new ferry time array
    function FillFerryArray(itemname) {
        var str;
        var FA;
        str = localStorage.getItem(itemname);
        if (str == null) return null;
        FA = str.split(";"); // fill array with strings
        // convert ferry time to a number
        for (var i = 0; i < FA.length; i = i + 2) {
            FA[i] = Number(FA[i]);  // convert to number
            if (isNaN(FA[i])) alert("Data error " + itemname + " " + i);
        }

        return FA;
    }

    /////////////////////////////////////////////////////////////////////////////////////////
    // Loads the next ferry times into the global 'table' as a row for each run. 
    // ferrytimesS, ferrytimesA is the array of times and days for Steelacoom and AI;
    //  Entry: table = table to add to
    //         ferrytimesS, A, K = array of ferry times for Steilacoom, AI, and Ketron
    //         global gYYmmdd = date
    //  Exit: builds table of run times. Note: cell id = YYmmddhhmmX where X=S/A/K
    function BuildFerrySchedule(ferrytimesS, ferrytimesA, ferrytimesK) {
        var i;
        var ft;
        var amcolor = "#f0ffff";
        var table = document.getElementById("ftable");
        // roll through the ferry times, skipping runs that are not valid for today
        for (i = 0; i < ferrytimesS.length; i = i + 2) {
            //if ((gTimehhmm >= (ferrytimesS[i] + extrat)) && (gTimehhmm >= (ferrytimesA[i] + extrat)) && (gTimehhmm > Number(ferrytimesK[i]))) continue;  // skip ferrys that have alreaedy run
            //if ((gTimehhmm >= (Number(ferrytimesS[i]) + extrat)) && (gTimehhmm >= (Number(ferrytimesA[i]) + extrat)) && (gTimehhmm > Number(ferrytimesK[i]))) continue;  // skip ferrys that have alreaedy run
            // now determine if the next run will run today.  If it is a valid run, break out of loop.
            //if (ValidFerryRun(ferrytimesS[i + 1], ferrytimesS[i])) {
                // Steelacoom
                var row1, row1col1, row1col2;
                row1 = table.insertRow(-1);
                row1col1 = row1.insertCell(0);
                row1col1.style.border.width = 1;
                row1col1.innerHTML = FormatTime(ferrytimesS[i]);
                row1col1.style.border = "thin solid black";
                if (ferrytimesS[i] < 1200) row1col1.style.backgroundColor = amcolor;
                // Insert rule
                row1col1 = row1.insertCell(1);
                row1col1.style.border = "thin solid black";
            //row1col1.innerHTML = "<textarea rows='2' cols='100'>" + ferrytimesS[i+1] + "</textarea>";
                row1col1.innerHTML = ferrytimeS[i + 1];
                row1col1.id = "S" + i.toFixed(); // id = yymmddhhmmS
                row1col1.onclick = function () { fclick(this.id) };
                row1col1 = row1.insertCell(2);  // statuss
                row1col1.style.border = "thin solid black";


                // Anderson Island;
                row1col2 = row1.insertCell(3);
                row1col2.innerHTML = FormatTime(ferrytimesA[i]);
                row1col2.style.color = "darkblue";
                row1col2.style.border = "thin solid black";
                if (ferrytimesA[i] < 1200) row1col2.style.backgroundColor = amcolor;
                // Insert rule
                row1col2 = row1.insertCell(4);
                row1col2.style.border = "thin solid black";
                //row1col2.innerHTML = "<textarea rows='2' cols='100'>" + ferrytimesA[i + 1] + "</textarea>";
                row1col2.innerHTML = ferrytimesA[i + 1];
                row1col2.id = "A" + i.toFixed(); // id = yymmddhhmmA
                row1col2.onclick = function () { fclick(this.id) };
                row1col2 = row1.insertCell(5);  // status
                row1col2.style.border = "thin solid black";

                // Ketron
                var row1col3 = row1.insertCell(6);
                row1col3.innerHTML = FormatTime(ferrytimesK[i]);
                row1col3.style.color = "brown";
                row1col3.style.border = "thin solid black";
                if (ferrytimesK[i] < 1200) row1col3.style.backgroundColor = amcolor;
                // Insert rule
                row1col3 = row1.insertCell(7);
                row1col3.style.border = "thin solid black";
                row1col3.innerHTML = ferrytimesK[i + 1];
                row1col3.id = "K" + i.toFixed(); // id = yymmddhhmmS
                row1col3.onclick = function () { fclick(this.id) };
                row1col3 = row1.insertCell(8);  // status    
                row1col3.style.border = "thin solid black";
        }
        return;
    }

    //////////////////////////////////////////////////////////////////////
    //  FormatTime()  returns just a fixed number
    function FormatTime(t) {
        return t.toFixed(0);
    }

    /////////////////////////////////////////////////////////////////////
    //  fclick - move stuff to edit box
    //  entry {S|A|K}index
    function fclick(id) {
        geditSAK = id.substr(0, 1);
        document.getElementById("editSAK").value = geditSAK;
        var i = Number(id.substr(1)); //index
        gediti = i;
        switch(geditSAK) {
            case "S": 
                document.getElementById("edittime").value = ferrytimeS[i];
                document.getElementById("editrule").value = ferrytimeS[i+1];
                break;
            case "A": 
                document.getElementById("edittime").value = ferrytimeA[i];
                document.getElementById("editrule").value = ferrytimeA[i + 1];
                break;
            case "K": 
                document.getElementById("edittime").value = ferrytimeK[i];
                document.getElementById("editrule").value = ferrytimeK[i + 1];
                break;
        }

    }
        
    ////////////////////////////////////////////////////////////////////////
    // EditCheck - verify the syntactic correctness of the edit expression
    //  Checks "editrule"
    //  returns true if ok, false if bad
    function CheckEdit() {
        var rule = document.getElementById("editrule").value;
        if (CheckRule(rule, true)) return;
        alert("invalid expression");
    }

    // empty is ok
    // * is ok
    // integer is ok
    // (valid javascript eval) is ok
    function CheckRule(rule, showresult) {
        if(rule=="") return true;
        if (rule == "*") return true;
        gDayofWeek = Number(document.getElementById("dayofweek").value);
        gMonthDay = Number(document.getElementById("monthday").value);
        gWeekofMonth = Number(document.getElementById("weekofmonth").value);
        if (rule.substr(0, 1) == "(") {
            try {
                r = eval(rule);
                if (showresult) alert("returns " + r);
                return true;
            } catch (e) {
                alert(e);
                return false;
            }
        }
        var patt =  /^[0123456]+$/;
        if(patt.test(rule)) return true; // numbers 0-6 only
        return true;
    }

    ///////////////////////////////////////////////////////////////////
    // SaveEdit - move the edit cell back into the ferrytime array 
    //  and regen the display table
    function SaveEdit() {
        if (geditSAK == "") return;
        var rule = document.getElementById("editrule").value;
        var ft = Number(document.getElementById("edittime").value);
        if (Number.isNaN(ft) == true) {
            alert("invalid time");
            return;
        }
        if (!CheckRule(rule, false)) {
            alert("invalied expression - can't save");
            return;
        }
        if (ft > 2400 || ft < 0) {
            alert("invalid time. can't save");
            return;
        }
        switch (geditSAK) {
                case "S":
                    ferrytimeS[gediti] = ft;
                    ferrytimeS[gediti + 1] = rule;
                    break;
                case "A":
                    ferrytimeA[gediti] = ft;
                    ferrytimeA[gediti + 1] = rule;
                    break;
                case "K":
                    ferrytimeK[gediti] = ft;
                    ferrytimeK[gediti + 1] = rule;
                    break;
        }
        clearTable(document.getElementById("ftable"));
        BuildFerrySchedule(ferrytimeS, ferrytimeA, ferrytimeK);
        alert("value saved for " + geditSAK + " " + ft.toFixed())
    }

    ///////////////////////////////////////////////////////////////////////////////
    // PCountEdit - parenthesis count for now
     function PCountEdit() {
        var rule = document.getElementById("editrule").value;
        var i;
        var pcount = 0;
        var p = "";
        for (i = 0; i < rule.length; i++) {
            var s = rule.substr(i, 1);
            if (s == "(") {
                pcount++;
                p = p + "(" + pcount.toFixed();
            } else if (s == ")") {
                p = p + ")" + pcount.toFixed();
                pcount--;
            } else {
                p = p + s;
            }
        }
        alert(p + "\nMissing Parens = " + pcount.toFixed()); // display paren count;

     }

    
    ////////////////////////////////////////////////////////////////////////////////
    //  CheckSchedule() - lchecks entire schedule and sets status
    //  returns true if no errors, else false;
     function CheckSchedule() {
         var i;
         var ok = true;
         for (i = 0; i < ferrytimeA.length; i+=2) {
             if(CheckRule(ferrytimeS[i+1], false) == false) {
                 alert("Error: Steilacoom " + ferrytimeS[i]);
                 ok = false;
             }
             if(CheckRule(ferrytimeA[i+1], false) == false) {
                 alert("Error: Anderson " + ferrytimeA[i]);
                 ok = false;
             }
             if(CheckRule(ferrytimeK[i+1], false) == false) {
                 alert("Error: Ketron " + ferrytimeK[i]);
                 ok = false;
             }
         }
         alert("Checked " + ferrytimeA.length + " entries. Result =" + ok);
         return ok;
     }
     ////////////////////////////////////////////////////////////////////////////////
     //  SaveSchedule() - saves entire schedule 
     function SaveSchedule() {
         var i;
         if (CheckSchedule() == false) {
             alert("can not save while there are errors.");
             return;
         }
         var FTA = "FERRYTA\n";
         var FTS = "FERRYTS\n";
         var FTK = "FERRYTK\n";
         for (i = 0; i < ferrytimeA.length; i+=2) {
             FTA = FTA + ferrytimeA[i].toFixed() + ";" + ferrytimeA[i + 1] + ";";
             FTS = FTS + ferrytimeS[i].toFixed() + ";" + ferrytimeS[i + 1] + ";";
             FTK = FTK + ferrytimeK[i].toFixed() + ";" + ferrytimeK[i + 1] + ";";
         }
         document.getElementById("editrule").value = FTS + "\n" + FTA + "\n" + FTK + "\n";
         alert("saved " + ferrytimeA.length.toFixed() + " rows to the edit box.");
     }

    /////////////////////////////////////////////////////////////////////////////////////////
    // clear table. Deletes all rows but the first.
    function clearTable(table) {
        // clear table
        while (table.rows.length > 1) {
            table.deleteRow(-1);
        }
    }

    /////////////////////////////////////////////////////////////////////////////////////////
    //  InList check for the argument in the list
    //  entry   a = value
    //          a1, a2, ... = values to test for
    //  returns true if a = a1 or a2 or a3, ...; e.g. InList(3,0,1,2,3,4) returns true because 3 is in the list
    function InList(a) {
        var i;
        for (i = 1; i < arguments.length; i++) { if (arguments[0] == arguments[i]) return true; }
        return false;
    }


    </script>

</body>
</html>